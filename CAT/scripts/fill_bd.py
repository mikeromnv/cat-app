from testing.models import Topic, Questions, Answers, Test, TestQuestions
from accounts.models import Users
from django.utils import timezone

# ----------------------------------------------------------------------
# 1. Создание тем
# ----------------------------------------------------------------------

topics_data = [
    ("Основы программирования", "Базовые понятия программирования"),
    ("ООП", "Объектно-ориентированное программирование"),
    ("Алгоритмы и структуры данных", "Базовые алгоритмические конструкции"),
    ("Базы данных", "SQL и реляционные модели"),
    ("Сетевое программирование", "Основы взаимодействия по сети"),
]

topics = {}

for name, desc in topics_data:
    topic, created = Topic.objects.get_or_create(
        topic_name=name,
        defaults={"description": desc}
    )
    topics[name] = topic

print("Темы созданы.")

# ----------------------------------------------------------------------
# 2. Вопросы по теме ООП (20 вопросов)
# ----------------------------------------------------------------------

oop_questions = [
    ("Что является основой объектно-ориентированного подхода?",
     -1.8, 0.9, 0.20,
     [
         ("Объекты и классы", True),
         ("Функции и процедуры", False),
         ("Глобальные переменные", False),
         ("Библиотеки", False)
     ]),

    ("Что такое объект в ООП?",
     -1.6, 1.0, 0.20,
     [
         ("Экземпляр класса", True),
         ("Имя функции", False),
         ("Тип данных", False),
         ("Файл проекта", False)
     ]),

    ("Что такое класс?",
     -1.5, 1.1, 0.20,
     [
         ("Шаблон для создания объектов", True),
         ("Переменная", False),
         ("Модуль", False),
         ("Окно интерфейса", False)
     ]),

    ("Что означает принцип инкапсуляции?",
     -1.2, 1.2, 0.18,
     [
         ("Сокрытие внутренней реализации объекта", True),
         ("Использование наследования", False),
         ("Полиморфизм", False),
         ("Абстрактные классы", False)
     ]),

    ("Какой принцип позволяет использовать единый интерфейс для разных реализаций?",
     -1.1, 1.1, 0.18,
     [
         ("Полиморфизм", True),
         ("Инкапсуляция", False),
         ("Агрегация", False),
         ("Ассоциация", False)
     ]),

    ("Зачем используется наследование?",
     -0.4, 1.3, 0.18,
     [
         ("Для расширения и переопределения поведения", True),
         ("Для скрытия реализации", False),
         ("Для создания объектов", False),
         ("Для обработки исключений", False)
     ]),

    ("Что такое абстрактный класс?",
     -0.3, 1.4, 0.18,
     [
         ("Класс, содержащий хотя бы один абстрактный метод", True),
         ("Класс без конструктора", False),
         ("Класс, который нельзя импортировать", False),
         ("Интерфейс", False)
     ]),

    ("Что такое интерфейс?",
     -0.2, 1.5, 0.17,
     [
         ("Набор методов без реализации", True),
         ("Класс без полей", False),
         ("Словарь методов", False),
         ("Тип данных", False)
     ]),

    ("Что означает переопределение метода?",
     0.0, 1.5, 0.18,
     [
         ("Создание новой реализации метода родительского класса", True),
         ("Создание метода с тем же именем в одном классе", False),
         ("Перегрузка оператора", False),
         ("Создание конструктора", False)
     ]),

    ("Что такое перегрузка метода?",
     0.1, 1.6, 0.18,
     [
         ("Методы с одинаковым именем, но разными параметрами", True),
         ("Замена метода родителя", False),
         ("Создание нового класса", False),
         ("Оптимизация кода", False)
     ]),

    ("Что такое композиция?",
     0.2, 1.6, 0.18,
     [
         ("Жёсткая связь: объект содержит часть другого объекта", True),
         ("Передача ссылки на объект", False),
         ("Переопределение методов", False),
         ("Инкапсуляция", False)
     ]),

    ("Что такое агрегация?",
     0.3, 1.3, 0.18,
     [
         ("Слабая связь объектов «часть–целое»", True),
         ("Полиморфизм", False),
         ("Наследование", False),
         ("Инкапсуляция", False)
     ]),

    ("Что такое SOLID?",
     0.5, 1.4, 0.17,
     [
         ("Набор принципов проектирования ООП", True),
         ("Алгоритм сортировки", False),
         ("Шаблон проектирования", False),
         ("Тип данных", False)
     ]),

    ("Что означает принцип L в SOLID?",
     0.6, 1.5, 0.18,
     [
         ("Подклассы должны заменять родительские классы", True),
         ("Открытость/закрытость", False),
         ("Разделение интерфейсов", False),
         ("Инверсия зависимостей", False)
     ]),

    ("Для чего используется полиморфизм?",
     0.7, 1.4, 0.18,
     [
         ("Для вызова разных реализаций через единый интерфейс", True),
         ("Для ускорения выполнения", False),
         ("Для работы с памятью", False),
         ("Для шифрования данных", False)
     ]),

    ("Зачем нужны абстрактные методы?",
     0.9, 1.7, 0.15,
     [
         ("Для задания обязательного поведения в наследниках", True),
         ("Для загрузки модулей", False),
         ("Для обращения к базе данных", False),
         ("Для работы с файловой системой", False)
     ]),

    ("Что обеспечивает принцип DIP?",
     1.1, 1.7, 0.15,
     [
         ("Зависимость от абстракций, а не от конкретных классов", True),
         ("Использование наследования", False),
         ("Перегрузка методов", False),
         ("Оптимизация памяти", False)
     ]),

    ("Что означает интерфейсная изоляция (ISP)?",
     1.3, 1.5, 0.15,
     [
         ("Лучше много маленьких интерфейсов, чем один большой", True),
         ("Скрытие реализации", False),
         ("Инверсия зависимостей", False),
         ("Наследование", False)
     ]),

    ("Что такое множественное наследование?",
     1.5, 1.8, 0.12,
     [
         ("Класс наследует нескольких родителей", True),
         ("Класс имеет несколько интерфейсов", False),
         ("Класс имеет несколько конструкторов", False),
         ("Класс перегружает методы", False)
     ]),

    ("Что такое MRO (Method Resolution Order)?",
     1.7, 2.0, 0.10,
     [
         ("Порядок поиска методов в иерархии класса", True),
         ("Оптимизация памяти", False),
         ("Порядок загрузки модулей", False),
         ("Инициализация переменных", False)
     ]),
]

author = Users.objects.filter(is_superuser=True).first()

created_questions = []

for text, b, a, c, answers in oop_questions:
    q = Questions.objects.create(
        text_question=text,
        difficulty=b,
        discrimination=a,
        guessing=c,
        topic=topics["ООП"],
        author=author
    )
    created_questions.append(q)

    for ans_text, is_corr in answers:
        ans = Answers.objects.create(
            question=q,
            answer_number=1,
            answer_text=ans_text,
            is_correct=is_corr
        )
        if is_corr:
            q.correct_answer = ans
            q.save()

print("Вопросы и ответы созданы.")

# ----------------------------------------------------------------------
# 3. Создание теста
# ----------------------------------------------------------------------

test = Test.objects.create(
    test_name="Тест по ООП (адаптивный)",
    author=author,
    topic=topics["ООП"],
    num_of_questions=20,
    created_at=timezone.now()
)

for q in created_questions:
    TestQuestions.objects.create(test=test, question=q)

print("Тест создан и заполнен вопросами.")


# python manage.py shell < scripts/fill_db.py